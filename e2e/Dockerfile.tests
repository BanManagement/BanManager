# syntax=docker/dockerfile:1
FROM node:22-alpine

WORKDIR /tests

# Install dependencies first for better caching
# Use BuildKit cache mount to persist npm cache between builds
COPY tests/package*.json ./
RUN --mount=type=cache,target=/root/.npm \
    npm ci

# Copy test source files
COPY tests/ ./

# Create cache directory for Jest/ts-jest transformations
# This will be mounted as a cache volume at runtime
RUN mkdir -p /tmp/jest_cache

# Set Jest cache directory via environment variable
ENV JEST_CACHE_DIRECTORY=/tmp/jest_cache

# Run tests
CMD ["npm", "test"]
